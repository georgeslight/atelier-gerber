stages:
  - deploy

variables:
  FLY_API_TOKEN: $FLY_API_TOKEN  # Set in GitLab CI/CD variables

# Deploy to staging from staging branch
deploy-staging:
  stage: deploy
  image: flyctl/flyctl:latest
  rules:
    - if: '$CI_COMMIT_BRANCH == "staging"'
  script:
    - echo "Deploying to Staging (kristin-gerber-staging)"
    - flyctl deploy --remote-only --app kristin-gerber-staging
    - echo "Staging deployed https://kristin-gerber-staging.fly.dev"

# Deploy to production from prod branch  
deploy-production:
  stage: deploy
  image: flyctl/flyctl:latest
  rules:
    - if: '$CI_COMMIT_BRANCH == "prod"'
  script:
    - echo "Deploying to Production (kristin-gerber)"
    - flyctl deploy --remote-only --app kristin-gerber
    - echo "Production deployed https://kristin-gerber.fly.dev"
